diff --git a/oggenc/audio.c b/oggenc/audio.c
index 477da8c..457038d 100644
--- a/oggenc/audio.c
+++ b/oggenc/audio.c
@@ -585,9 +585,20 @@ int wav_open(FILE *in, oe_enc_opt *opt, unsigned char *oldbuf, int buflen)
 
         wav->channel_permute = malloc(wav->channels * sizeof(int));
         if (wav->channels <= 8)
-            /* Where we know the mappings, use them. */
-            memcpy(wav->channel_permute, wav_permute_matrix[wav->channels-1], 
+        {
+            if (wav->channel_permute != NULL)
+            {
+                /* Where we know the mappings, use them. */
+                memcpy(wav->channel_permute, wav_permute_matrix[wav->channels-1], 
                     sizeof(int) * wav->channels);
+            }
+            else
+            {
+                fprintf(stderr, 
+                    _("ERROR: Memory allocation failed.\n"));
+                return 0;
+            }
+        }
         else
             /* Use a default 1-1 mapping */
             for (i=0; i < wav->channels; i++)
